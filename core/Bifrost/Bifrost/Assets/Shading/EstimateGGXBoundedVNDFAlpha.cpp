// Estimate the alpha of the GGX bounded VNDF distribution based on the maximal PDF when sampling the bounded VNDF
// and the angle between the view direction and the normal.
// ------------------------------------------------------------------------------------------------
// Copyright (C) Bifrost. See AUTHORS.txt for authors
//
// This program is open source and distributed under the New BSD License.
// See LICENSE.txt for more detail.
// ------------------------------------------------------------------------------------------------
// Generated by MaterialPrecomputations application.
// ------------------------------------------------------------------------------------------------

#include <Bifrost/Assets/Shading/Fittings.h>
#include <Bifrost/Math/ImageSampling.h>

namespace Bifrost::Assets::Shading::Estimate_GGX_bounded_VNDF_alpha {

const int alpha_sample_count = 1024;
const int wo_dot_normal_sample_count = 32;
const int max_PDF_sample_count = 32;

const float alphas[] = {
    // wo_dot_normal 0
    1, 0.946426, 0.88617, 0.835804, 0.792527, 0.754539, 0.720615, 0.689888, 0.661725, 0.635642, 0.611264, 0.588294, 0.566488, 0.545645, 0.525591, 0.506177, 0.487266, 0.468732, 0.450457, 0.43232, 0.414197, 0.395956, 0.377444, 0.358478, 0.338831, 0.318196, 0.296136, 0.271979, 0.244556, 0.211493, 0.166223, 0, 
    // wo_dot_normal 0.0322581
    1, 0.945267, 0.883787, 0.832464, 0.78841, 0.749774, 0.715302, 0.684101, 0.65552, 0.629067, 0.604357, 0.581086, 0.559007, 0.537911, 0.517624, 0.497991, 0.478874, 0.460148, 0.441689, 0.423378, 0.405087, 0.386684, 0.368014, 0.348896, 0.329097, 0.30831, 0.286098, 0.261782, 0.234195, 0.20095, 0.155453, 0, 
    // wo_dot_normal 0.0645161
    1, 0.944017, 0.881228, 0.828885, 0.784011, 0.744696, 0.709647, 0.67795, 0.648937, 0.6221, 0.597046, 0.573465, 0.551102, 0.529746, 0.509219, 0.489362, 0.470036, 0.451113, 0.432467, 0.413976, 0.395515, 0.376947, 0.358116, 0.33884, 0.318885, 0.297945, 0.275577, 0.2511, 0.223345, 0.18992, 0.144236, 0, 
    // wo_dot_normal 0.0967742
    1, 0.942675, 0.878489, 0.825069, 0.779332, 0.739306, 0.703659, 0.671449, 0.641989, 0.614758, 0.589353, 0.565456, 0.542806, 0.521188, 0.500418, 0.480338, 0.460802, 0.441682, 0.42285, 0.404184, 0.385556, 0.366827, 0.347842, 0.328416, 0.308318, 0.287237, 0.264733, 0.240129, 0.212256, 0.178754, 0.13316, 0, 
    // wo_dot_normal 0.129032
    1, 0.941233, 0.875561, 0.821003, 0.774363, 0.733597, 0.697331, 0.664594, 0.634677, 0.607046, 0.581286, 0.557072, 0.534135, 0.512256, 0.491247, 0.470947, 0.451208, 0.431899, 0.412891, 0.394059, 0.375277, 0.356403, 0.337283, 0.317732, 0.297517, 0.276335, 0.253747, 0.229087, 0.201209, 0.167839, 0.122847, 0, 
    // wo_dot_normal 0.16129
    1, 0.939685, 0.872432, 0.816677, 0.769092, 0.727562, 0.69066, 0.657385, 0.627006, 0.598972, 0.572858, 0.54833, 0.525112, 0.502979, 0.481741, 0.461232, 0.441303, 0.42182, 0.402654, 0.383678, 0.364764, 0.345773, 0.326551, 0.306914, 0.286636, 0.265413, 0.242822, 0.21822, 0.190516, 0.15755, 0.113672, 0, 
    // wo_dot_normal 0.193548
    1, 0.938022, 0.86909, 0.812077, 0.763512, 0.721194, 0.683643, 0.649824, 0.618982, 0.590549, 0.564088, 0.539254, 0.515766, 0.493395, 0.471944, 0.451246, 0.431148, 0.411515, 0.392217, 0.373129, 0.35412, 0.335054, 0.315777, 0.296112, 0.275836, 0.254659, 0.232174, 0.207772, 0.180424, 0.148137, 0.10575, 0, 
    // wo_dot_normal 0.225806
    1, 0.936234, 0.865521, 0.807192, 0.757613, 0.714489, 0.676283, 0.641919, 0.61062, 0.581797, 0.555002, 0.529878, 0.50614, 0.483551, 0.461912, 0.44105, 0.420813, 0.401065, 0.381673, 0.362513, 0.343455, 0.324367, 0.305096, 0.285473, 0.265281, 0.244246, 0.221983, 0.197921, 0.171103, 0.139695, 0.0989774, 0, 
    // wo_dot_normal 0.258065
    1, 0.934314, 0.861715, 0.802012, 0.751389, 0.707446, 0.668582, 0.633682, 0.601937, 0.572742, 0.545632, 0.520243, 0.496281, 0.473504, 0.451708, 0.430718, 0.410382, 0.390559, 0.371119, 0.351938, 0.332887, 0.313837, 0.294642, 0.275135, 0.255113, 0.234316, 0.212385, 0.188779, 0.162624, 0.132214, 0.093197, 0, 
    // wo_dot_normal 0.290323
    1, 0.932249, 0.857655, 0.796525, 0.744835, 0.700067, 0.660552, 0.625129, 0.592958, 0.563415, 0.536019, 0.510397, 0.486245, 0.463316, 0.441404, 0.42033, 0.399939, 0.38009, 0.360655, 0.341509, 0.322526, 0.303579, 0.284528, 0.265213, 0.245442, 0.224968, 0.203451, 0.180395, 0.154977, 0.125609, 0.0882269, 0, 
    // wo_dot_normal 0.322581
    1, 0.930028, 0.85333, 0.790723, 0.737948, 0.692359, 0.652207, 0.616284, 0.583716, 0.553857, 0.526212, 0.500394, 0.476094, 0.453059, 0.431076, 0.409965, 0.389571, 0.369751, 0.350375, 0.331321, 0.312466, 0.293685, 0.274844, 0.255787, 0.236333, 0.216247, 0.195211, 0.172755, 0.148105, 0.119773, 0.0839229, 0, 
    // wo_dot_normal 0.354839
    1, 0.927639, 0.848725, 0.784598, 0.730731, 0.684332, 0.643568, 0.607175, 0.574247, 0.544113, 0.516262, 0.490296, 0.465895, 0.442801, 0.4208, 0.399706, 0.379361, 0.359623, 0.340362, 0.321457, 0.302787, 0.284228, 0.26565, 0.246907, 0.227819, 0.208168, 0.187648, 0.165816, 0.141936, 0.114598, 0.0801637, 0, 
    // wo_dot_normal 0.387097
    1, 0.925068, 0.843829, 0.778146, 0.723189, 0.676002, 0.634659, 0.597838, 0.564596, 0.534235, 0.506229, 0.480165, 0.455716, 0.432618, 0.410649, 0.389624, 0.369382, 0.349779, 0.330685, 0.311979, 0.293542, 0.275251, 0.256981, 0.238589, 0.219904, 0.20071, 0.180724, 0.159515, 0.136385, 0.109984, 0.0768426, 0, 
    // wo_dot_normal 0.419355
    1, 0.922302, 0.838629, 0.771365, 0.71533, 0.66739, 0.625513, 0.588315, 0.554811, 0.524279, 0.496171, 0.470065, 0.445623, 0.422573, 0.400691, 0.379786, 0.359696, 0.340275, 0.321394, 0.302929, 0.284763, 0.266778, 0.248847, 0.23083, 0.212564, 0.193842, 0.174387, 0.153789, 0.131374, 0.105855, 0.0738933, 0, 
    // wo_dot_normal 0.451613
    1, 0.919324, 0.833114, 0.764257, 0.707173, 0.658525, 0.616168, 0.57865, 0.544945, 0.5143, 0.486151, 0.460059, 0.435677, 0.412729, 0.390983, 0.370245, 0.35035, 0.331153, 0.31252, 0.294331, 0.276467, 0.25881, 0.241236, 0.22361, 0.205772, 0.187519, 0.168584, 0.148571, 0.126837, 0.102132, 0.0712504, 0, 
    // wo_dot_normal 0.483871
    1, 0.916121, 0.827278, 0.75683, 0.698738, 0.649439, 0.606667, 0.568895, 0.535052, 0.504358, 0.476225, 0.450203, 0.425936, 0.403137, 0.381572, 0.361042, 0.341381, 0.322439, 0.304085, 0.286194, 0.268651, 0.251338, 0.234132, 0.216899, 0.199484, 0.181691, 0.16326, 0.143807, 0.122706, 0.0987589, 0.0688672, 0, 
    // wo_dot_normal 0.516129
    1, 0.912677, 0.821117, 0.749096, 0.690052, 0.640172, 0.597055, 0.5591, 0.525187, 0.494505, 0.466448, 0.440549, 0.416443, 0.393837, 0.372492, 0.352205, 0.332807, 0.314145, 0.296088, 0.278514, 0.261303, 0.24434, 0.227503, 0.210662, 0.193662, 0.176315, 0.158363, 0.139439, 0.118937, 0.0956888, 0.066703, 0, 
    // wo_dot_normal 0.548387
    1, 0.908977, 0.81463, 0.741074, 0.681149, 0.630767, 0.587384, 0.549319, 0.515403, 0.484794, 0.456866, 0.431139, 0.407239, 0.384863, 0.363769, 0.34375, 0.324636, 0.306273, 0.288528, 0.271278, 0.254403, 0.237791, 0.22132, 0.204862, 0.188263, 0.171341, 0.153848, 0.135422, 0.115478, 0.0928811, 0.064726, 0, 
    // wo_dot_normal 0.580645
    1, 0.905006, 0.807824, 0.732791, 0.672068, 0.62127, 0.577705, 0.539603, 0.50575, 0.475272, 0.447522, 0.422009, 0.398348, 0.376233, 0.355414, 0.335685, 0.31687, 0.298817, 0.281389, 0.264466, 0.247927, 0.231661, 0.215547, 0.199459, 0.183248, 0.166734, 0.149674, 0.131716, 0.112291, 0.0902994, 0.0629131, 0, 
    // wo_dot_normal 0.612903
    1, 0.900754, 0.800711, 0.724278, 0.662856, 0.611736, 0.568068, 0.530002, 0.496271, 0.465976, 0.438449, 0.413185, 0.389793, 0.36796, 0.347436, 0.328008, 0.309501, 0.291762, 0.274654, 0.258055, 0.241849, 0.225921, 0.210154, 0.194422, 0.178582, 0.162454, 0.145804, 0.128287, 0.109348, 0.0879177, 0.0612456, 0, 
    // wo_dot_normal 0.645161
    1, 0.896215, 0.793312, 0.715577, 0.65356, 0.602213, 0.558524, 0.520561, 0.487009, 0.45694, 0.429669, 0.404684, 0.381582, 0.36005, 0.33983, 0.320712, 0.302518, 0.285092, 0.268303, 0.252023, 0.236141, 0.22054, 0.205107, 0.189718, 0.174229, 0.158468, 0.142205, 0.125102, 0.10662, 0.0857125, 0.0597016, 0, 
    // wo_dot_normal 0.677419
    1, 0.891387, 0.78566, 0.706736, 0.644236, 0.592755, 0.549122, 0.511321, 0.477996, 0.44819, 0.421205, 0.396519, 0.373723, 0.352501, 0.332593, 0.313787, 0.295903, 0.27879, 0.262311, 0.246345, 0.230774, 0.21549, 0.200378, 0.185315, 0.170163, 0.154749, 0.138849, 0.122137, 0.10408, 0.083663, 0.0582689, 0, 
    // wo_dot_normal 0.709677
    1, 0.886279, 0.777794, 0.697811, 0.634941, 0.583415, 0.539906, 0.502321, 0.469259, 0.439746, 0.413068, 0.388695, 0.366216, 0.345308, 0.325713, 0.307217, 0.289641, 0.272834, 0.256659, 0.240994, 0.225728, 0.210746, 0.195941, 0.181189, 0.166354, 0.15127, 0.135714, 0.119367, 0.10171, 0.0817516, 0.0569328, 0, 
    // wo_dot_normal 0.741935
    1, 0.880912, 0.769773, 0.688866, 0.625734, 0.574245, 0.530918, 0.49359, 0.460824, 0.431624, 0.405267, 0.381215, 0.359055, 0.338463, 0.319179, 0.300988, 0.283715, 0.267204, 0.251323, 0.23595, 0.220974, 0.206284, 0.19177, 0.177314, 0.162781, 0.148007, 0.132776, 0.116774, 0.099494, 0.0799644, 0.0556857, 0, 
    // wo_dot_normal 0.774194
    1, 0.875327, 0.761668, 0.679974, 0.616679, 0.565296, 0.522198, 0.485159, 0.45271, 0.423835, 0.397806, 0.374078, 0.352237, 0.331957, 0.312977, 0.295086, 0.278104, 0.261881, 0.246284, 0.231191, 0.216493, 0.20208, 0.187843, 0.173668, 0.159422, 0.144942, 0.130017, 0.11434, 0.0974148, 0.0782889, 0.0545165, 0, 
    // wo_dot_normal 0.806452
    1, 0.869592, 0.753572, 0.671219, 0.607846, 0.556621, 0.513787, 0.477057, 0.444934, 0.416391, 0.39069, 0.367284, 0.345755, 0.325779, 0.307097, 0.289494, 0.272795, 0.256849, 0.241522, 0.226697, 0.212263, 0.198114, 0.184144, 0.170235, 0.156259, 0.142057, 0.127421, 0.112051, 0.0954597, 0.0767133, 0.0534146, 0, 
    // wo_dot_normal 0.83871
    1, 0.863813, 0.745606, 0.662705, 0.599315, 0.548281, 0.505728, 0.469313, 0.437519, 0.409303, 0.383923, 0.36083, 0.339605, 0.319924, 0.301526, 0.284201, 0.267772, 0.252089, 0.237021, 0.222452, 0.20827, 0.194371, 0.180651, 0.166995, 0.153275, 0.139337, 0.124975, 0.109895, 0.0936175, 0.0752299, 0.0523818, 0, 
    // wo_dot_normal 0.870968
    1, 0.858164, 0.737941, 0.654564, 0.591185, 0.540352, 0.498076, 0.461969, 0.43049, 0.40259, 0.377517, 0.354722, 0.333787, 0.314386, 0.29626, 0.279198, 0.263025, 0.247592, 0.232769, 0.21844, 0.204497, 0.190836, 0.177353, 0.163935, 0.150458, 0.136768, 0.122664, 0.107857, 0.0918785, 0.0738297, 0.0514023, 0, 
    // wo_dot_normal 0.903226
    1, 0.852929, 0.730832, 0.646994, 0.583608, 0.532945, 0.490916, 0.455088, 0.423899, 0.396286, 0.371497, 0.348978, 0.328311, 0.309171, 0.291297, 0.274481, 0.258548, 0.243349, 0.228757, 0.214655, 0.200936, 0.187497, 0.174237, 0.161045, 0.147796, 0.134341, 0.120481, 0.105932, 0.0902348, 0.0725048, 0.0504799, 0, 
    // wo_dot_normal 0.935484
    1, 0.848635, 0.724745, 0.640353, 0.576853, 0.526271, 0.484412, 0.448797, 0.417841, 0.39047, 0.365924, 0.343646, 0.323216, 0.304307, 0.286661, 0.270068, 0.254353, 0.239369, 0.224987, 0.211094, 0.197583, 0.184352, 0.1713, 0.158317, 0.145282, 0.132046, 0.118416, 0.104111, 0.0886774, 0.0712507, 0.0496024, 0, 
    // wo_dot_normal 0.967742
    1, 0.846529, 0.720812, 0.635534, 0.571624, 0.520881, 0.479002, 0.44345, 0.412605, 0.385376, 0.360989, 0.338882, 0.318628, 0.299901, 0.282437, 0.266026, 0.250494, 0.235693, 0.221496, 0.207786, 0.194458, 0.181414, 0.168549, 0.155758, 0.142919, 0.129887, 0.116468, 0.102389, 0.0872051, 0.0700624, 0.048773, 0, 
    // wo_dot_normal 1
    1, 0.857744, 0.730515, 0.642119, 0.575664, 0.523034, 0.479777, 0.443216, 0.411632, 0.383859, 0.359075, 0.33668, 0.316223, 0.297356, 0.279805, 0.263349, 0.247805, 0.233018, 0.218858, 0.205206, 0.191954, 0.178999, 0.166239, 0.153566, 0.140858, 0.127972, 0.114717, 0.100822, 0.0858471, 0.0689544, 0.0479911, 0, 
};

float encode_PDF(float pdf) {
    float non_linear_PDF = pdf / (1.0f + pdf);
    float encoded_PDF = (non_linear_PDF - 0.13f) / 0.87f;
    if (isnan(encoded_PDF))
        encoded_PDF = 1.0f;
    return encoded_PDF;
}

float estimate_alpha(float wo_dot_normal, float max_PDF) {
    float encoded_PDF = encode_PDF(max_PDF);

    return Math::ImageSampling::bilinear(alphas, max_PDF_sample_count, wo_dot_normal_sample_count, encoded_PDF, wo_dot_normal);
}

} // NS Bifrost::Assets::Shading::Estimate_GGX_bounded_VNDF_alpha
